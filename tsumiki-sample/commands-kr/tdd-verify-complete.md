# TDD 테스트 케이스 완전성 검증

TDD 개발에서 테스트 케이스의 구현이 완전히 완료되었는지를 검증합니다.

## 검증의 목적

리팩토링 후에, 예정했던 테스트 케이스가 모두 구현되었는지를 확인하고, 구현 누락을 방지합니다.

## 검증 절차

### 1. 기존 테스트의 그린 상태 확인

- **필수**: 모든 기존 테스트가 성공하고 있는지를 확인
- `npm test` 또는 `jest`를 실행하여 테스트 결과를 확인
- 테스트 실패가 있는 경우 먼저 수정이 필요
- 모든 테스트가 그린인 것을 확인한 후 다음 단계로 진행

### 2. TDD 메모 파일과 요구사항 정의 문서의 확인
- `doc/implementation/{test_case_name}-memo.md`를 확인 (메모 파일이 존재하는 경우)
- `doc/implementation/{feature_name}-requirements.md`를 확인
- `doc/implementation/{feature_name}-testcases.md`를 확인
- `doc/todo.md`를 확인하여 대상 태스크의 현재 상태를 파악
- 예정했던 테스트 케이스 수와 내용을 파악

### 2. 구현된 테스트 케이스의 확인

- 현재의 테스트 파일을 확인
- 구현된 테스트 케이스 수를 카운트
- 각 테스트 케이스의 내용을 예정과 대조

### 3. 구현 상황의 분석과 TODO.md 업데이트 판정

다음의 형식으로 분석 결과를 제공해 주세요:

```
## 테스트 케이스 구현 상황

### 📋 TODO.md 대상 태스크 확인
- **대상 태스크**: [현재의 TDD 개발 대상 태스크명]
- **현재의 상태**: [미완료/부분 완료/완료됨]
- **완료 마크 필요**: [필요/불필요]

### 📋 예정 테스트 케이스 (요구사항 정의로부터)
- **총수**: [예정했던 총 테스트 케이스 수]
- **분류**:
  - 정상 케이스: [수]개
  - 예외 케이스: [수]개
  - 엣지 케이스: [수]개
  - 기타: [수]개

### ✅ 구현된 테스트 케이스
- **총수**: [구현된 총 테스트 케이스 수]
- **성공률**: [통과 테스트 수]/[구현 테스트 수] ([성공률]%)

### ❌ 미구현 테스트 케이스 ([수]개)
1. **테스트 케이스명**: [예정했지만 미구현인 테스트]
   - **종류**: [정상 케이스/예외 케이스/엣지 케이스]
   - **내용**: [테스트의 상세 내용]
   - **중요도**: [높음/중간/낮음]
   - **요구사항 항목**: [대응하는 요구사항 정의서의 항목]

2. **테스트 케이스명**: [2번째 미구현 테스트]
   ...

### 📋 요구사항 정의서 망라성 체크
- **요구사항 항목 총수**: [요구사항 정의서의 총 항목 수]
- **구현된 항목**: [구현·테스트된 항목 수]
- **요구사항 망라율**: [구현된 수]/[총수] = [망라율]%

#### 미망라의 요구사항 항목 ([수]개)
1. **요구사항 항목**: [미구현인 요구사항 항목명]
   - **분류**: [입력 매개변수/출력 사양/제약 조건/사용 예/오류 케이스 등]
   - **내용**: [요구사항의 상세 내용]
   - **구현 부족의 이유**: [왜 미구현인가]
   - **대응의 필요성**: [필수/권장/임의]

2. **요구사항 항목**: [2번째 미망라 항목]
   ...

### 📊 구현률
- **전체 구현률**: [구현 수]/[예정 수] = [구현률]%
- **정상 케이스 구현률**: [구현 수]/[예정 수] = [구현률]%
- **예외 케이스 구현률**: [구현 수]/[예정 수] = [구현률]%
- **엣지 케이스 구현률**: [구현 수]/[예정 수] = [구현률]%
```

### 4. 판정 기준

#### ✅ 완전 구현됨 (자동으로 다음 단계)

```
- 기존 테스트 상태: 모두 그린
- 요구사항 망라율: 100% (전 요구사항 항목 구현·테스트됨)
- 테스트 성공률: 100%
- 미구현 중요 요구사항: 0개
- 품질 기준: 요구사항 정의에 대한 완전한 충실도를 달성
```

#### ⚠️ 구현 부족 있음 (추가 구현 필요)

```
- 기존 테스트 상태: 실패 테스트 있음 또는
- 요구사항 망라율: 100% 미만 (요구사항 정의의 항목에 대한 구현 부족)
- 중요한 요구사항 항목이 미구현·미테스트
- 요구사항 충실도에 품질 리스크 있음
```

### 5. 검증 결과의 메모 파일 기록과 TODO.md 업데이트

#### 메모 파일에의 추가
검증 완료 후, 다음의 정보를 `doc/implementation/{test_case_name}-memo.md`에 추가:

```markdown
# [기능명] TDD 개발 완료 기록

## 확인해야 할 문서

- `docs/implements/{{task_id}}/{feature_name}-requirements.md`
- `docs/implements/{{task_id}}/{feature_name}-testcases.md`

## 🎯 최종 결과 ([일시])
- **구현률**: [수]% ([구현 수]/[예정 수] 테스트 케이스)
- **품질 판정**: [합격/불합격] 
- **TODO 업데이트**: [✅ 완료 마크 추가/개선 필요]

## 💡 중요한 기술 학습
### 구현 패턴
[앞으로 재사용할 수 있는 중요한 구현 기법]

### 테스트 설계
[효과적이었던 테스트 접근법]

### 품질 보증
[품질 확보에서 중요했던 관점]

## ⚠️ 주의점 (해당 시에만)
[구현 시의 중요한 주의사항이나 미완료 항목]

---
*기존 메모 내용에서 중요한 정보를 통합하고, 중복·상세한 경과 기록은 삭제*
```

**통합 업데이트 규칙:**
1. **중요 정보 유지**: 기존 메모의 기술적 학습 포인트·재사용 가능 패턴을 통합
2. **중복 삭제**: 유사한 기록·상세한 경과는 최신 정보에 집약  
3. **간결화**: 날짜·수치 등의 상세는 최종 결과만 유지
4. **재사용 중시**: 앞으로의 개발에서 참고가 되는 정보를 우선해서 남김
5. **관련 정보 중시**: 사양 정보 등의 정보는 우선해서 남김

#### TODO.md 완료 마크 자동 업데이트

검증이 완료된 경우, 다음의 절차로 TODO.md를 자동 업데이트:

1. **완료 태스크의 특정**: 현재의 TDD 개발 대상 태스크를 특정
2. **완료 마크 추가**: 해당 태스크에 `✅ **완료**` 마크를 추가
3. **완료 이유 기재**: `(TDD 개발 완료 - [테스트 수] 테스트 케이스 전 통과)`를 추가
4. **서브 태스크 업데이트**: 관련하는 서브 태스크에도 `[x]` 체크 마크를 추가

예:

```markdown
### 1. JSON 파일 경로 인수 처리 기능 ✅ **완료** (TDD 개발 완료 - 15 테스트 케이스 전 통과)

- [x] 커맨드 라인 인수로 JSON 파일 경로를 받는 기능을 추가
- [x] 복수의 JSON 파일 경로에 대응 (sample/ 디렉토리 전체의 읽기)
- [x] 인수 유효성 검사 기능
```

### 6. 대응 액션

#### 완전 구현된 경우

다음의 메시지와 함께 다음의 권장 커맨드를 표시:

```
✅ 테스트 케이스 완전성 검증: 합격
- 예정 테스트 케이스: [수]개 모두 구현됨
- 테스트 성공률: 100%
- 품질 기준: 달성

다음의 권장 단계: `/tdd-cycle`로 다음 TDD 사이클을 시작합니다.
```

**메모 파일 기록**: 검증 결과를 메모 파일에 자동 추가한다.
**TODO.md 업데이트**: 완료한 태스크에 ✅ 완료 마크를 자동 추가한다.

#### 구현 부족이 있는 경우

다음의 메시지를 제공하고, 추가 구현을 촉진:

```
⚠️ 테스트 케이스 구현 부족을 검출

미구현 테스트 케이스 ([수]개)가 있습니다.
완전한 품질 보증을 위해, 다음의 추가 구현을 권장합니다:

[미구현 테스트 케이스의 리스트]

추가 구현을 수행합니까? 아니면 현상태로 다음 단계에 진행합니까?
```

**메모 파일 기록**: 구현 부족의 검증 결과도 메모 파일에 추가한다.
**TODO.md 업데이트**: 구현 부족의 경우에도, 부분 완료한 태스크가 있으면 적절히 마크한다.

## 검증 대상 파일

### 확인해야 할 문서
- `doc/todo.md` - 프로젝트 전체의 태스크 완료 상황 (완료 마크 업데이트 대상)
- `doc/implementation/{feature_name}-requirements.md`
- `doc/implementation/{feature_name}-testcases.md`

### 확인해야 할 테스트 파일

- `src/__tests__/*.test.ts`
- `src/__tests__/*.test.js`

### 확인해야 할 구현 파일

- `src/*.ts`
- `src/*.js`

### Git에서 변경된 파일

- `git status`로 변경된 파일
- `git diff --name-only`로 변경된 파일

## 품질 기준

### 최저 품질 기준

- **구현률**: 80% 이상
- **성공률**: 100%
- **중요 테스트**: 모두 구현
- **요구사항 망라성**: 요구사항 정의서의 주요 기능을 모두 망라
- **컴파일 오류**: 없음

### 이상 품질 기준

- **구현률**: 100%
- **성공률**: 100%
- **망라성**: 전 케이스 대응
- **요구사항 완전 망라**: 요구사항 정의서의 전 항목을 망라

### 요구사항 정의서의 망라성 체크

요구사항 정의서 (requirements.md)에 기재된 다음의 항목이 구현·테스트되고 있는지를 확인:

#### 필수 체크 항목

- **입력 매개변수**: 모든 필수·옵션 인수의 처리
- **출력 사양**: 기대되는 출력 형식·구조의 구현
- **제약 조건**: 성능·보안·호환성 요구사항
- **기본 사용 예**: 예상되는 기본적인 사용 패턴
- **엣지 케이스**: 경계값·예외 조건의 처리
- **오류 케이스**: 예외 케이스의 적절한 처리
- **주요 알고리즘**: 기능의 핵이 되는 처리 로직

#### 망라성 판정 기준

```
✅ 완전 망라 (100%):
- 요구사항 정의서의 전 항목이 구현·테스트되고 있음
- 입력 매개변수의 전 패턴을 테스트
- 출력 사양의 전 형식을 검증
- 오류 케이스·엣지 케이스를 모두 망라

⚠️ 부분 망라 (80-99%):
- 주요 기능은 구현되고 있지만 일부 항목이 미구현
- 기본적인 사용 예는 망라되고 있음
- 중요하지 않은 오류 케이스의 일부가 미구현

❌ 불충분 (<80%):
- 요구사항 정의서의 중요한 항목이 미구현
- 기본적인 사용 예에 누락이 있음
- 오류 핸들링이 불충분
```

## 자동 이행 판정

### 품질 판정 기준

```
✅ 고품질 (요구사항 충실도 완전 달성):
- 기존 테스트 상태: 모두 그린
- 요구사항 망라율: 100% (요구사항 정의서의 전 항목에 대한 완전한 구현·테스트)
- 테스트 성공률: 100%
- 미구현 중요 요구사항: 0개
- 요구사항 충실도: 요구사항 정의에 대한 완전한 충실도를 달성

⚠️ 개선 필요 (요구사항 충실도 부족):
- 기존 테스트 상태: 실패 테스트 있음 또는
- 요구사항 망라율: 100% 미만 (요구사항 정의서의 항목에 대한 구현·테스트 부족)
- 중요한 요구사항 항목이 미구현·미테스트
- 요구사항 충실도: 요구사항 정의에 대한 충실도가 불충분
- 추가 구현에 의한 요구사항 충실도 향상이 필요
```

## 사용 예

```bash
# refactor 페이즈 후에 자동 실행
/tdd-refactor
# ↓ 자동 실행
/tdd-verify-complete
# ↓ 구현 완전하면 자동 실행
/tdd-cycle
```

## 출력 형식

구현 상황에 따라 다음의 어느 하나의 형식으로 출력:

### 완전 구현의 경우

```
✅ **테스트 케이스 완전성 검증: 합격**

📊 이번 태스크 요구사항 충실도:
- 대상 요구사항 항목: [수]개
- 구현·테스트됨: [수]개 / 미구현: [수]개
- 요구사항 망라율: 100%
- 요구사항 충실도: 완전 달성

📊 전체의 테스트 상황:
- 전 테스트 케이스 총수: [수]개  
- 성공: [수]개 / 실패: [수]개
- 전체 테스트 성공률: [수]%

🚀 요구사항 정의에 대한 완전한 충실도를 달성했습니다.
자동으로 다음 TDD 사이클에 진행합니다.
```

### 구현 부족의 경우

```
⚠️ **테스트 케이스 구현 부족을 검출**

📊 이번 태스크 요구사항 충실도:
- 대상 요구사항 항목: [수]개
- 구현·테스트됨: [수]개 / 미구현: [수]개  
- 요구사항 망라율: [수]%
- 요구사항 충실도: [충실도 레벨]

📊 전체의 테스트 상황:
- 전 테스트 케이스 총수: [수]개
- 성공: [수]개 / 실패: [수]개
- 전체 테스트 성공률: [수]%

❌ 미구현 테스트 케이스:
[미구현 테스트 케이스의 상세 리스트]

🤔 요구사항 충실도 향상을 위해 추가 구현을 수행합니까?
```

이 검증에 의해, TDD 개발의 품질과 완전성을 확보합니다.
